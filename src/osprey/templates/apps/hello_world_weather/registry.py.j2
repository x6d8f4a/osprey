"""
{{ app_display_name }} Application Registry.

Provides registry configuration for the {{ app_display_name }} tutorial application,
including capability and context class registrations for the Alpha Berkeley
Agent Framework. This registry demonstrates the simple, beginner-friendly pattern
using extend_framework_registry() to automatically include framework defaults.

This is the recommended pattern for most applications - you only specify what's
unique to your application, and the framework provides the rest (routing, memory,
time parsing, Python execution, etc.). This reduces boilerplate by ~70%!

The registry integrates seamlessly with the framework's discovery system,
enabling automatic loading of capabilities and context classes without manual
configuration beyond this file.
"""

from osprey.registry import (
    extend_framework_registry,
    CapabilityRegistration,
    ContextClassRegistration,
    FrameworkPromptProviderRegistration,
    RegistryConfig,
    RegistryConfigProvider
)

class {{ app_class_name }}RegistryProvider(RegistryConfigProvider):
    """Registry configuration provider for {{ app_display_name }} tutorial application.

    This registry demonstrates the simple, beginner-friendly pattern for creating
    application registries. It uses extend_framework_registry() to automatically
    include all framework components (routing, orchestration, memory, Python
    execution, etc.) and adds only the weather-specific capability.

    This is the recommended pattern for most applications:
    - Framework provides: Routing, memory, time parsing, Python execution, communication
    - You provide: Your domain-specific capabilities (weather, in this case)

    Benefits of this pattern:
    - Clean, readable code (~20 lines instead of 200+)
    - Automatic framework updates (framework changes don't break your registry)
    - Focus on what's unique to your application
    - Clear learning path (see what you add, explore framework defaults later)

    Component Registration:
        - **current_weather**: Capability for retrieving weather conditions
        - **CURRENT_WEATHER**: Context type for weather data exchange
        - **WeatherPromptProvider**: Custom task extraction prompts for conversational context

    To see what the framework provides automatically, run:
        >>> from osprey.registry import get_framework_defaults
        >>> framework = get_framework_defaults()
        >>> print([c.name for c in framework.capabilities])
        ['memory', 'time_range_parsing', 'python', 'respond', 'clarify']

    :raises RegistryError: If component module paths are invalid or classes not found
    :raises ImportError: If application modules cannot be imported during registration

    .. note::
       This is a tutorial application demonstrating the simple registry pattern.
       For applications that need to exclude or override framework components,
       see the wind_turbine tutorial which uses exclude_capabilities parameter.

    .. warning::
       All module paths must be importable and class names must exist in their
       respective modules. Invalid paths will cause framework initialization to fail.

    Examples:
        Registry provider usage::

            >>> from {{ package_name }}.registry import {{ app_class_name }}RegistryProvider
            >>> provider = {{ app_class_name }}RegistryProvider()
            >>> config = provider.get_registry_config()
            >>> print(f"Total capabilities: {len(config.capabilities)}")
            Total capabilities: 6  # 5 framework + 1 application

        Accessing registered components::

            >>> from osprey.registry import get_registry
            >>> registry = get_registry()
            >>> weather_capability = registry.get_capability("current_weather")
            >>> memory_capability = registry.get_capability("memory")  # From framework!

    .. seealso::
       :func:`extend_framework_registry` : Helper function used by this registry
       :func:`get_framework_defaults` : Inspect framework components
       :class:`CurrentWeatherCapability` : Weather capability registered here
       :class:`CurrentWeatherContext` : Weather context registered here
    """

    def get_registry_config(self) -> RegistryConfig:
        """Provide complete registry configuration for {{ app_display_name }} application.

        Uses extend_framework_registry() to automatically include all framework
        components and add only the weather-specific capability and context class.

        The framework provides (automatically included):
        - Core infrastructure: Router, orchestrator, classifier, error handler
        - Framework capabilities: Memory, time parsing, Python execution, communication
        - Standard context classes: MEMORY_CONTEXT, TIME_RANGE, PYTHON_RESULTS
        - Core data sources: User memory provider
        - Internal services: Python executor

        This application adds:
        - current_weather capability
        - CURRENT_WEATHER context class
        - Weather-specific task extraction prompt customization

        :return: Complete registry configuration with framework + application components
        :rtype: RegistryConfig

        .. note::
           This is the recommended pattern for most applications. It's clean,
           maintainable, and automatically benefits from framework updates.

        Examples:
            The returned config includes both framework and application components::

                >>> config = provider.get_registry_config()
                >>> # Framework capabilities included automatically
                >>> assert any(c.name == "memory" for c in config.capabilities)
                >>> assert any(c.name == "python" for c in config.capabilities)
                >>> # Application capability added
                >>> assert any(c.name == "current_weather" for c in config.capabilities)
        """
        return extend_framework_registry(
            # Add weather-specific capability
            capabilities=[
                CapabilityRegistration(
                    name="current_weather",
                    module_path="{{ package_name }}.capabilities.current_weather",
                    class_name="CurrentWeatherCapability",
                    description="Get current weather conditions for a location",
                    provides=["CURRENT_WEATHER"],
                    requires=[]
                )
            ],

            # Add weather-specific context class
            context_classes=[
                ContextClassRegistration(
                    context_type="CURRENT_WEATHER",
                    module_path="{{ package_name }}.context_classes",
                    class_name="CurrentWeatherContext"
                )
            ],

            # Add weather-specific prompt customizations
            framework_prompt_providers=[
                FrameworkPromptProviderRegistration(
                    module_path="{{ package_name }}.framework_prompts",
                    prompt_builders={
                        "task_extraction": "WeatherTaskExtractionPromptBuilder"
                    }
                )
            ]
        )

